!function(){"use strict";function e(e,t){var n=function(e){for(var t=e.split(/([#.])/),n="",i="",o=[],s=0;s<t.length;s++){var r=t[s];"#"===r?i=t[++s]:"."===r?o.push(t[++s]):r.length&&(n=r)}return{tag:n||"div",id:i,className:o.join(" ")}}(e),i=n.tag,o=n.id,s=n.className,r=t?document.createElementNS(t,i):document.createElement(i);return o&&(r.id=o),s&&(t?r.setAttribute("class",s):r.className=s),r}function t(e,t){var i=f(e),o=f(t);return t===o&&o.__redom_view&&(t=o.__redom_view),o.parentNode&&(n(t,o,i),i.removeChild(o)),t}function n(e,t,n){var o=t.__redom_lifecycle;if(i(o))t.__redom_lifecycle={};else{var s=n;for(t.__redom_mounted&&a(t,"onunmount");s;){var r=s.__redom_lifecycle||{};for(var d in o)r[d]&&(r[d]-=o[d]);i(r)&&(s.__redom_lifecycle=null),s=s.parentNode}}}function i(e){if(null==e)return!0;for(var t in e)if(e[t])return!1;return!0}var o=["onmount","onremount","onunmount"],s="undefined"!=typeof window&&"ShadowRoot"in window;function r(e,t,i,r){var d=f(e),c=f(t);t===c&&c.__redom_view&&(t=c.__redom_view),t!==c&&(c.__redom_view=t);var u=c.__redom_mounted,h=c.parentNode;return u&&h!==d&&n(0,c,h),null!=i?r?d.replaceChild(c,f(i)):d.insertBefore(c,f(i)):d.appendChild(c),function(e,t,n,i){for(var r=t.__redom_lifecycle||(t.__redom_lifecycle={}),d=n===i,c=!1,u=0,h=o;u<h.length;u+=1){var l=h[u];d||e!==t&&l in e&&(r[l]=(r[l]||0)+1),r[l]&&(c=!0)}if(!c)return void(t.__redom_lifecycle={});var f=n,p=!1;(d||f&&f.__redom_mounted)&&(a(t,d?"onremount":"onmount"),p=!0);for(;f;){var m=f.parentNode,v=f.__redom_lifecycle||(f.__redom_lifecycle={});for(var y in r)v[y]=(v[y]||0)+r[y];if(p)break;(f.nodeType===Node.DOCUMENT_NODE||s&&f instanceof ShadowRoot||m&&m.__redom_mounted)&&(a(f,d?"onremount":"onmount"),p=!0),f=m}}(t,c,d,h),t}function a(e,t){"onmount"===t||"onremount"===t?e.__redom_mounted=!0:"onunmount"===t&&(e.__redom_mounted=!1);var n=e.__redom_lifecycle;if(n){var i=e.__redom_view,o=0;for(var s in i&&i[t]&&i[t](),n)s&&o++;if(o)for(var r=e.firstChild;r;){var d=r.nextSibling;a(r,t),r=d}}}function d(e,t,n){e.style[t]=null==n?"":n}var c="http://www.w3.org/1999/xlink";function u(e,t,n,i){var o=f(e);if("object"==typeof t)for(var s in t)u(o,s,t[s],i);else{var r=o instanceof SVGElement,a="function"==typeof n;if("style"===t&&"object"==typeof n)!function(e,t,n){var i=f(e);if("object"==typeof t)for(var o in t)d(i,o,t[o]);else d(i,t,n)}(o,n);else if(r&&a)o[t]=n;else if("dataset"===t)!function e(t,n,i){if("object"==typeof n)for(var o in n)e(t,o,n[o]);else null!=i?t.dataset[n]=i:delete t.dataset[n]}(o,n);else if(r||!(t in o)&&!a||"list"===t){if(r&&"xlink"===t)return void function e(t,n,i){if("object"==typeof n)for(var o in n)e(t,o,n[o]);else null!=i?t.setAttributeNS(c,n,i):t.removeAttributeNS(c,n,i)}(o,n);i&&"class"===t&&(n=o.className+" "+n),null==n?o.removeAttribute(t):o.setAttribute(t,n)}else o[t]=n}}function h(e){return document.createTextNode(null!=e?e:"")}function l(e,t,n){for(var i=0,o=t;i<o.length;i+=1){var s=o[i];if(0===s||s){var a=typeof s;"function"===a?s(e):"string"===a||"number"===a?e.appendChild(h(s)):p(f(s))?r(e,s):s.length?l(e,s,n):"object"===a&&u(e,s,null,n)}}}function f(e){return e.nodeType&&e||!e.el&&e||f(e.el)}function p(e){return e&&e.nodeType}var m={};function v(e){for(var t,n=arguments,i=[],o=arguments.length-1;o-- >0;)i[o]=n[o+1];var s=typeof e;if("string"===s)t=g(e).cloneNode(!1);else if(p(e))t=e.cloneNode(!1);else{if("function"!==s)throw new Error("At least one argument required");var r=e;t=new(Function.prototype.bind.apply(r,[null].concat(i)))}return l(f(t),i,!0),t}var y=v;function g(t){return m[t]||(m[t]=e(t))}function w(e,t,n){for(var i=n,o=new Array(t.length),s=0;s<t.length;s++)o[s]=t[s]&&f(t[s]);for(var a=0;a<t.length;a++){var d=t[a];if(d){var c=o[a];if(c!==i)if(p(c)){var u=i&&i.nextSibling,h=null!=d.__redom_index&&u===o[a+1];r(e,d,i,h),h&&(i=u)}else null!=d.length&&(i=w(e,d,i));else i=i.nextSibling}}return i}v.extend=function(e){for(var t=arguments,n=[],i=arguments.length-1;i-- >0;)n[i]=t[i+1];var o=g(e);return v.bind.apply(v,[this,o].concat(n))};var _=function(e,t,n){this.View=e,this.initData=n,this.oldLookup={},this.lookup={},this.oldViews=[],this.views=[],null!=t&&(this.key="function"==typeof t?t:function(e){return function(t){return t[e]}}(t))};function x(e,t,n,i){return new k(e,t,n,i)}_.prototype.update=function(e,t){for(var n=this.View,i=this.key,o=this.initData,s=null!=i,r=this.lookup,a={},d=new Array(e.length),c=this.views,u=0;u<e.length;u++){var h=e[u],l=void 0;if(s){var p=i(h);l=r[p]||new n(o,h,u,e),a[p]=l,l.__redom_id=p}else l=c[u]||new n(o,h,u,e);l.update&&l.update(h,u,e,t),f(l.el).__redom_view=l,d[u]=l}this.oldViews=c,this.views=d,this.oldLookup=r,this.lookup=a};var k=function(e,t,n,i){this.View=t,this.initData=i,this.views=[],this.pool=new _(t,n,i),this.el=function(e){return"string"==typeof e?v(e):f(e)}(e),this.keySet=null!=n};k.prototype.update=function(e,n){void 0===e&&(e=[]);var i=this.keySet,o=this.views;this.pool.update(e,n);var s=this.pool,r=s.views,a=s.lookup;if(i)for(var d=0;d<o.length;d++){var c=o[d];null==a[c.__redom_id]&&(c.__redom_index=null,t(this,c))}for(var u=0;u<r.length;u++){r[u].__redom_index=u}!function(e){for(var n=arguments,i=[],o=arguments.length-1;o-- >0;)i[o]=n[o+1];for(var s=f(e),r=w(e,i,s.firstChild);r;){var a=r.nextSibling;t(e,r),r=a}}(this,r),i&&(this.lookup=a),this.views=r},k.extend=function(e,t,n,i){return k.bind(k,e,t,n,i)},x.extend=k.extend;var b=function(e,t){this.el=h(""),this.visible=!1,this.view=null,this._placeholder=this.el,e instanceof Node?this._el=e:e.el instanceof Node?(this._el=e,this.view=e):this._View=e,this._initData=t};b.prototype.update=function(e,n){var i=this._placeholder,o=this.el.parentNode;if(e){if(!this.visible)if(this._el)r(o,this._el,i),t(o,i),this.el=f(this._el),this.visible=e;else{var s=new(0,this._View)(this._initData);this.el=f(s),this.view=s,r(o,s,i),t(o,i)}this.view&&this.view.update&&this.view.update(n)}else if(this.visible){if(this._el)return r(o,i,this._el),t(o,this._el),this.el=i,void(this.visible=e);r(o,i,this.view),t(o,this.view),this.el=i,this.view=null}this.visible=e};var E="http://www.w3.org/2000/svg",L={};function z(e){for(var t,n=arguments,i=[],o=arguments.length-1;o-- >0;)i[o]=n[o+1];var s=typeof e;if("string"===s)t=M(e).cloneNode(!1);else if(p(e))t=e.cloneNode(!1);else{if("function"!==s)throw new Error("At least one argument required");var r=e;t=new(Function.prototype.bind.apply(r,[null].concat(i)))}return l(f(t),i,!0),t}function M(t){return L[t]||(L[t]=e(t,E))}z.extend=function(e){var t=M(e);return z.bind(this,t)},z.ns=E;var T=function(){this.el=y(".menu-item")};T.prototype.update=function(e){var t=this,n=e.name,i=e.onclick;this.el.textContent=n,this.el.onclick=function(e){i(e),t.el.blur()}};var S=function(){this.el=x(".menu",T)};S.prototype.update=function(e){this.el.update(e)};var C={width:448,height:512,path:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},N=function(e){var t=e.id,n=e.x,i=e.y,o=e.name;this.el=y(".player",{style:{transform:"translate("+n+"em, "+i+"em)"}},y(".symbol",z("svg",{height:"3em",viewBox:"0 0 "+C.width+" "+C.height},z("path",{d:C.path}))),y(".name",o)),this.id=t,this.x=n,this.y=i,this.name=o},P=function(e){void 0===e&&(e={});var t=e.width,n=e.height;this.el=y(".stage",this.$cards=y(".cards"),this.$players=y(".players")),this.cards=[],this.players=[],this.x=0,this.y=0,this.width=t,this.height=n,this.size=1};P.prototype.update=function(){var e=Math.min(1,Math.min(window.innerWidth/2100,window.innerHeight/1400));this.size<e?this.size=e:this.size>1&&(this.size=1);var t=-(1050*this.size-window.innerWidth/2),n=1050*this.size-window.innerWidth/2,i=-(700*this.size-window.innerHeight/2),o=700*this.size-window.innerHeight/2;t>n&&(t=n=0),i>o&&(i=o=0),this.x<t?this.x=t:this.x>n&&(this.x=n),this.y<i?this.y=i:this.y>o&&(this.y=o),this.el.style.transform="translate("+this.x+"px, "+this.y+"px) scale("+this.size+", "+this.size+")"},P.prototype.get=function(e){for(var t=0;t<this.cards.length;t++)if(this.cards[t]._id===e)return this.cards[t]},P.prototype.reset=function(){for(var e=0;e<this.cards.length;e++)this.cards.splice(e--,1);for(var n=0;n<this.players.length;n++)this.players.splice(n--,1);for(;this.$cards.firstChild;)t(this.$cards,this.$cards.firstChild);for(;this.$players.firstChild;)t(this.$players,this.$players.firstChild)},P.prototype.remove=function(e){for(var n=0;n<this.cards.length;n++)this.cards[n]===e&&(this.cards.splice(n--,1),t(this.$cards,e))},P.prototype.pushPlayer=function(e){this.players.push(e),r(this.$players,new N(e))},P.prototype.push=function(e){this.cards.push(e),r(this.$cards,e)},P.prototype.ondeckcardpop=function(e,t){e.pop(),window.multiplayer&&O(this.socket,t._id,"deckpop",{_id:t._id})},P.prototype.oncardclick=function(e){window.multiplayer?O(this.socket,e._id,"cardflip",{_id:e._id}):(e.frontside=!e.frontside,e.update())},P.prototype.oncardmovestart=function(e,t){t.card=!0,e._moveStart={x:e.x,y:e.y},this._moveStart={x:this.x,y:this.y},window.multiplayer?O(this.socket,e._id,"cardmovestart",{_id:e._id}):(this.remove(e),this.push(e))},P.prototype.oncardmove=function(e,t,n,i){var o=this;i.card=!0;var s,r={x:e._moveStart.x+t/this.size,y:e._moveStart.y+n/this.size};this.players.forEach((function(e){var t=16*e.x,n=16*e.y;Math.abs(r.x-t)<100&&Math.abs(r.y-n)<100&&(s=e)})),(s&&s._id)!==e.player&&(e.player=s&&s._id,window.multiplayer&&O(this.socket,e._id,"playercard",{_id:e._id,player:s&&s._id})),s||(r.x<-746?(r.x=-746,this.el.style.borderColor="#ccc",clearTimeout(this.collisionTimeout),this.collisionTimeout=setTimeout((function(){o.el.style.borderColor=""}),2e3)):r.x>746&&(r.x=746,this.el.style.borderColor="#ccc",clearTimeout(this.collisionTimeout),this.collisionTimeout=setTimeout((function(){o.el.style.borderColor=""}),2e3)),r.y<-376?(r.y=-376,this.el.style.borderColor="#ccc",clearTimeout(this.collisionTimeout),this.collisionTimeout=setTimeout((function(){o.el.style.borderColor=""}),2e3)):r.y>376&&(r.y=376,this.el.style.borderColor="#ccc",clearTimeout(this.collisionTimeout),this.collisionTimeout=setTimeout((function(){o.el.style.borderColor=""}),2e3)),e.move(r.x,r.y,!0),window.multiplayer&&O(this.socket,e._id,"cardmove",{_id:e._id,x:r.x,y:r.y}))},P.prototype.oncardmoveend=function(e,t,n,i){if(i.card=!0,window.multiplayer){var o={x:e._moveStart.x+t/this.size,y:e._moveStart.y+n/this.size};j["cardmove."+e._id]=!1,O(this.socket,e._id,"cardmove",{_id:e._id,x:o.x,y:o.y})}};var j={};function O(e,t,n,i){if("cardmove"===n){if(j[n+"."+t])return;j[n+"."+t]=!0}e.emit(n,i,(function(){"cardmove"===n&&(j[n+"."+t]=!1)}))}var D=function(e){return e.x-e.width/2},q=function(e){return e.x+e.width/2},I=function(e){return e.y-e.height/2},G=function(e){return e.y+e.height/2};var Y=window.requestAnimationFrame||function(e){setTimeout(e,0)},X=function(){this.animations=[]};X.prototype.add=function(e){this.animations.push(e)},X.prototype.render=function(){for(var e=this.animations,t=Date.now(),n=0;n<e.length;n++){var i=e[n];if(!(t<i.start)){i.started||(i.started=!0,i.onstart&&i.onstart());var o=Math.min(1,(t-i.start)/(i.end-i.start)),s=i.ease(o);i.onprogress&&i.onprogress(s,o),t>=i.end&&(i.onend&&i.onend(),e.splice(n--,1))}}},X.prototype.remove=function(e){for(var t=this.animations,n=0;n<t.length;n++)t[n]===this&&t.splice(n--,1)};var A,$=new X,V=function(e){return function(t){return Math.pow(t,e)}},H=function(e){return function(t){return 1-Math.abs(Math.pow(t-1,e))}},R=function(e){return function(t){return t<.5?V(e)(2*t)/2:H(e)(2*t-1)/2+.5}},B={linear:function(e){return e},quadIn:V(2),quadOut:H(2),quadInOut:R(2),cubicIn:V(3),cubicOut:H(3),cubicInOut:R(3),quartIn:V(4),quartOut:H(4),quartInOut:R(4),quintIn:V(5),quintOut:H(5),quintInOut:R(5),sineIn:function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},sineOut:function(e){return Math.sin(Math.PI/2*e)},sineInOut:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},bounce:function(e){var t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375}},U=function(e){void 0===e&&(e={});var t=e.delay;void 0===t&&(t=0);var n=e.duration;void 0===n&&(n=0);var i=e.easing;void 0===i&&(i="quadOut");var o=e.oninit,s=e.onstart,r=e.onprogress,a=e.onend;A||(A=Y(F));var d=Date.now();if(this.initTime=d,this.delay=t,this.duration=n,this.easing=i,this.onstart=s,this.onprogress=r,this.onend=a,!this.ease)throw new Error("Easing not found");$.add(this),o&&o()},W={start:{configurable:!0},end:{configurable:!0},ease:{configurable:!0}};function F(){$.render(),A=Y(F)}function J(e){for(var t=[],n=[],i=[],o=0;o<e.cards.length;o++){var s={x:e.cards[o].x,y:e.cards[o].y,i:o};s.xStart=s.x,s.yStart=s.y,t.push(s);var r=e.width/2*16;Math.random()<.5?(n.push(s),s.xTarget=-r-r*Math.random()):(i.push(s),s.xTarget=r+r*Math.random())}return new Promise((function(n){e.cards.forEach((function(i,o){var s=new U({delay:54*o*2/e.cards.length,duration:225,easing:"quadInOut"});i.animation=s;var r=t[o],a=r.xStart,d=r.xTarget;s.onprogress=function(n){i.x=a+n*(d-a),i.y=-e.d*o,t[o].x=i.x,t[o].y=i.y,i.update()},s.onend=function(){o===Math.round(e.cards.length/2)&&n()}}))})).then((function(){return Promise.all(e.cards.map((function(o,s){return new Promise((function(r){Math.random()<.5?t[s]=n.length?n.shift():i.shift():t[s]=i.length?i.shift():n.shift(),o.animation.destroy();var a=t[s].x,d=t[s].y,c=-e.d*s,u=-e.d*s;o.x=a,o.y=d,o.update();var h=new U({delay:54*s*2/e.cards.length,duration:225,easing:"quadInOut"});h.onprogress=function(e){o.x=a+e*(c-a),o.y=d+e*(u-d),o.update()},h.onend=function(){r()}}))})))}))}W.start.get=function(){return this.initTime+this.delay},W.end.get=function(){return this.start+this.duration},W.ease.get=function(){return B[this.easing]},U.prototype.destroy=function(){$.remove(this)},U.from=function(e,t){return e*(1-t)},Object.defineProperties(U.prototype,W),U.ease=B;var K=function(e){this.stage=e,this.cards=[],this.x=0,this.y=0,this.d=1/4,this.z=0},Q={width:{configurable:!0},height:{configurable:!0}};K.prototype.reset=function(){for(var e=0;e<this.cards.length;e++)this.cards.splice(e--,1)},K.prototype.intro=function(){!function(e){e.cards=[].concat(e.stage.cards);var t=0;Promise.all(e.cards.map((function(e,n){return new Promise((function(n){var i=e.x,o=e.y-300,s=e.x,r=e.y;e.frontside=!0,e.el.style.opacity=0,e.update();var a=new U({delay:1e3+10*t++,duration:1e3,easing:"quartOut"});a.onstart=function(){e.frontside=!1,e.el.style.opacity=""},a.onprogress=function(t,n){e.x=i+t*(s-i),e.y=o+t*(r-o),e.update()},a.onend=function(){e.frontside=!1,n()}}))}))).then((function(){e.resetPositions()}))}(this)},K.prototype.pop=function(){this.cards.pop().deck=null},K.prototype.collision=function(e){for(var t=0;t<this.cards.length;t++)if(this.cards[t]!==e&&(n=this.cards[t],i=e,D(n)<q(i)&&q(n)>D(i)&&I(n)<G(i)&&G(n)>I(i)))return!0;var n,i;return!1},K.prototype.oncardlongpress=function(e,t){var n=this;this._moving=!0,this.cards.forEach((function(e){n.stage.oncardmovestart(e,t),e.el.classList.add("moving"),e.el.classList.add("movingdeck")}))},K.prototype.oncardmovestart=function(e,t){return!this.shuffling&&(this.cards[this.cards.length-1]===e&&(this.stage.oncardmovestart(e,t),void e.el.classList.add("moving")))},K.prototype.oncardmove=function(e,t,n,i){var o=this;this._moving?this.cards.forEach((function(e,s){o.stage.oncardmove(e,t,n,i)})):this.stage.oncardmove(e,t,n,i)},K.prototype.oncardmoveend=function(e,t,n,i){var o=this;this._moving?(this._moving=!1,this.cards.forEach((function(e,s){o.stage.oncardmoveend(e,t,n,i),e.el.classList.remove("moving"),e.el.classList.remove("movingdeck")}))):(this.stage.ondeckcardpop(this,e),e.el.classList.remove("moving"),this.stage.oncardmoveend(e,t,n,i))},K.prototype.shuffle=function(){var e=this;if(!this.shuffling)return this.shuffling=!0,J(this).then((function(){return J(e)})).then((function(){e.shuffling=!1}))},K.prototype.collect=function(){return function(e){e.cards=[];for(var t=0;t<e.stage.cards.length;t++)e.cards.push(e.stage.cards[t]);var n=0;return Promise.all(e.cards.map((function(t,i){return new Promise((function(o){var s=t.x,r=t.y,a=-e.d*i,d=-e.d*i;if(s===a&&r===d)return o();var c=new U({delay:10*n++,duration:300,easing:"quadInOut"});c.onprogress=function(e,n){t.x=s+e*(a-s),t.y=r+e*(d-r),t.update()},c.onend=o}))}))).then((function(){e.resetPositions()}))}(this)},Q.width.get=function(){return this.stage.width},Q.height.get=function(){return this.stage.height},K.prototype.resetPositions=function(){this.z=0;for(var e=0;e<this.cards.length;e++){var t=this.cards[e];t.x=-this.d*e,t.y=-this.d*e,t.z=this.z++,t.frontside=!1,t.player=null,this.stage.remove(t),this.stage.push(t),t.deck=this,t.update()}},K.prototype.push=function(e){e.deck=this,this.cards.push(e)},Object.defineProperties(K.prototype,Q);var Z=!1;try{var ee=Object.defineProperty({},"passive",{get:function(){Z=!0}});window.addEventListener("testPassive",null,ee),window.removeEventListener("testPassive",null,ee)}catch(e){}var te=!!Z&&{passive:!1};var ne=function(e){var t=this;this.x=0,this.y=0,this.stage=e,this.data={},this.el=y(".card"),function(e){var t;function n(n){if(n.preventDefault(),!("mousedown"===n.type&&n.which>1||n.touches&&n.touches.length>1||e.onmovestart&&!1===e.onmovestart(n))){var i=Date.now();"touchstart"===n.type?(document.addEventListener("touchmove",d,te),document.addEventListener("touchend",c,te)):(document.addEventListener("mousemove",d,te),document.addEventListener("mouseup",c,te));var o=n.touches?n.touches[0].pageX:n.pageX,s=n.touches?n.touches[0].pageY:n.pageY,r={x:0,y:0},a=!1;t=setTimeout((function(){a||e.onlongpress&&e.onlongpress(n)}),1e3)}function d(t){if(t.preventDefault(),!(t.touches&&t.touches.length>1)){var n=t.touches?t.touches[0].pageX:t.pageX,i=t.touches?t.touches[0].pageY:t.pageY,d={x:n-o,y:i-s};r.x=d.x,r.y=d.y,e.onmove&&e.onmove(d.x,d.y,t),(Math.abs(r.x)>5||Math.abs(r.y)>5)&&(a=!0),e.update()}}function c(n){n.preventDefault(),"touchend"===n.type?(document.removeEventListener("touchmove",d),document.removeEventListener("touchend",c)):(document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",c)),e.onmoveend&&e.onmoveend(r.x,r.y,n),!a&&Date.now()-i<300&&e.onclick&&e.onclick(),clearTimeout(t)}}e.el.addEventListener("touchstart",n,te),e.el.addEventListener("mousedown",n,te)}(this),this.el.style.backgroundImage="url(/img/standard-deck/back.png",this.onlongpress=function(e){t.deck&&t.deck.oncardlongpress(t,e)},this.onclick=function(){t.stage.oncardclick(t)},this.onmovestart=function(e){return t.deck?t.deck.oncardmovestart(t,e):t.stage.oncardmovestart(t,e)},this.onmove=function(e,n,i){return t.deck?t.deck.oncardmove(t,e,n,i):t.stage.oncardmove(t,e,n,i)},this.onmoveend=function(e,n,i){return t.deck?t.deck.oncardmoveend(t,e,n,i):t.stage.oncardmoveend(t,e,n,i)}},ie={width:{configurable:!0},height:{configurable:!0}};ie.width.get=function(){return this.stage.width},ie.height.get=function(){return this.stage.height},ne.prototype.getSuit=function(e){return Math.floor(e/13)},ne.prototype.getValue=function(e){return e%13},ne.prototype.getColor=function(e){return this.getSuit(e)%2},ne.prototype.move=function(e,t,n){this.x=e,this.y=t,this.el.style.transform="translate("+this.x/16+"em, "+this.y/16+"em)"},ne.prototype.update=function(){if(this.move(this.x,this.y),this.frontside!==this._frontside){if(this._frontside=this.frontside,!this.frontside)return this.el.style.backgroundImage="url(/img/standard-deck/back.png",void(this._i=null);this.el.style.backgroundImage="url(/img/standard-deck/front-"+this.i+".png)"}this.frontside&&null!=this.i&&this.i!==this._i&&(this._i=this.i)},Object.defineProperties(ne.prototype,ie);var oe=0,se=function(e){this._id=oe++,this.x=0,this.y=0,this.z=e.moveUp(),this.width=6.25,this.height=8.75,this.frontside=!1,this.moveUp=function(){return e.moveUp()}};var re=function(e){this.cards=new Array(54),this.cardLookup={},this.d=1/4,this.z=0;for(var t=0;t<this.cards.length;t++){var n=new se(e);n.i=this.cards.length-1-t,n.deck=!0,this.cards[t]=n,this.cardLookup[n._id]=n}this.init()};re.prototype.shuffle=function(){!function(e){if(!e.length)return e;for(var t=e.length-1;t;t--){var n=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[n],e[n]=i}}(this.cards),this.z=0,this.init()},re.prototype.init=function(){for(var e=0;e<this.cards.length;e++){var t=this.cards[e];t.x=-e*this.d,t.y=-e*this.d,t.z=this.z++,t.frontside=!1,t.deck=!0}};var ae=function(){this.z=0,this.deck=new re(this)};function de(e,t,n){var i=new XMLHttpRequest;return i.open("POST",e,!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.onload=function(){200===i.status?n&&n(null,JSON.parse(i.responseText)):n&&n(i.status,i.responseText)},i.onerror=function(e){n&&n(e,i.responseText)},t?i.send(JSON.stringify(t)):i.send(),i}ae.prototype.moveUp=function(){return this.z++};var ce=function(e){var t=e.oncancel;this.el=y(".multiplayer",this.wrapper=y(".wrapper",this.createButton=y(".button","Create multiplayer game"),this.creatingGame=y(".button.disabled","Creating multiplayer game..."),this.copyGame=y(".input",y(".label","Share game link:"),this.copyGameInput=y("input",{readonly:!0})),this.play=y(".button","Play"),this.error=y(".button.disabled"),this.join=y("form",this.enterName=y(".input",y(".label","Enter your name:"),this.name=y("input",{placeholder:"John Doe",autofocus:!0}),y("p",{style:{color:"#888",padding:".5rem",fontSize:".75rem"}},{innerHTML:"Privacy notice: You can send messages to other players in the game. Messages, players and games get deleted from servers automatically after 24Â hours. Transfer of all data is secure (HTTPS)."})),this.joinGame=y(".button","Join game")),this.joiningGame=y(".button.disabled","Joining game..."))),this.wrapper.onclick=function(e){e.multiplayer=!0},this.el.onclick=function(e){e.multiplayer||t()}};ce.prototype.update=function(e){var t=this,n=e.join,i=e.game,o=e.onstart;e.oncancel;this.creatingGame.style.display="none",this.copyGame.style.display="none",this.play.style.display="none",this.error.style.display="none",this.creatingGame.style.display="none",this.enterName.style.display="none",this.joinGame.style.display="none",this.joiningGame.style.display="none",n&&(this.createButton.style.display="none",this.enterName.style.display="",this.joinGame.style.display="",this.join.onsubmit=function(e){e.preventDefault(),t.enterName.style.display="none",t.joinGame.style.display="none",t.joiningGame.style.display="",de("/api/game/join",{game:i,name:t.name.value},(function(e,n){if(t.joiningGame.style.display="none",e)return t.error.textContent="Something went wrong ðŸ˜ž",void(t.error.style.display="");var i=n.game,s=n.player;o({game:i,player:s})}))},this.joinGame.onclick=this.join.onsubmit),this.createButton.onclick=function(){t.creatingGame.style.display="",t.createButton.style.display="none",de("/api/game/create",{},(function(e,n){if(t.creatingGame.style.display="none",e)return t.error.textContent="Something went wrong ðŸ˜ž",void(t.error.style.display="");var i=n.game;t.copyGame.style.display="",t.copyGameInput.value="https://deck.of.cards/play/"+i,t.play.style.display="",t.play.onclick=function(){location.pathname="/play/"+i}}))}};var ue=function(){var e=this;this.data=[],this.lastReadAt=0,this.opened=!1,this.el=y(".messages",this.title=y(".messages-title","Messages"),this.messages=x(".messages-list",le),this.form=y("form",y(".messages-compose",this.message=y("input",{maxlength:1e3}),y("div",y("button","Send message"))))),this.messages.el.style.display="none",this.form.style.display="none",window.addEventListener("wheel",(function(e){e.letScroll=!0}),!0),this.title.onclick=function(){e.opened=!e.opened,e.opened?(e.messages.el.style.display="",e.form.style.display=""):(e.messages.el.style.display="none",e.form.style.display="none"),e.update()}},he={onsubmit:{configurable:!0}};ue.prototype.update=function(e){if(void 0===e&&(e=this.data),this.data=e,this.messages.update(e),this.unread=0,this.opened){this.el.classList.add("opened");for(var t=0;t<e.length;t++)this.lastReadAt=e[t].time;this.title.textContent="Messages"}else{this.el.classList.remove("opened");for(var n=0;n<e.length;n++)new Date(e[n].time)>this.lastReadAt&&this.unread++;this.unread?this.title.textContent=1===this.unread?this.unread+" unread message":this.unread+" unread messages":this.title.textContent="Messages"}this.messages.el.scrollTop=this.messages.el.scrollHeight},he.onsubmit.set=function(e){var t=this;this.form.onsubmit=function(n){n.preventDefault(),t.message.value&&e(t.message.value.slice(0,1e3)),t.message.value=""}},Object.defineProperties(ue.prototype,he);var le=function(){this.el=y(".message",this.name=y(".message-name"),this.time=y(".message-time"),this.message=y(".message-message"))};le.prototype.update=function(e){var t=e._player,n=e.time,i=e.message;this.name.textContent=t,this.time.textContent=new Date(n).toLocaleTimeString(),this.message.textContent=i};var fe=new ae,pe=new P({width:6.25,height:8.75}),me=new K(pe);pe.game=fe,pe.deck=me;for(var ve=0;ve<fe.deck.cards.length;ve++){var ye=new ne(pe);ye._id=fe.deck.cards[ve]._id,ye.i=fe.deck.cards[ve].i,ye.update(),me.push(ye),pe.push(ye)}me.resetPositions(),window.multiplayer||me.intro(),r(document.body,pe,document.querySelector(".oldlink"));var ge=function(e,t){var n=new ue;n.onsubmit=function(n){o.emit("message",{message:n,game:e,player:t})},r(document.body,n);var i="dev.of.cards"===location.hostname?"/":"https://ws.of.cards/",o=io.connect(i,{query:{game:e||"",player:t||""}}),s=[],a={};o.on("hello",(function(e){pe.reset(),pe.deck.reset();var t=e.cards;e.players.forEach((function(e){if(e.you){var t=e._id,n=e.name,i=e.x,s=e.y;o.emit("player",{_id:t,name:n,x:i,y:s})}pe.pushPlayer(e),a[e._id]=e})),n.update(e.messages.map((function(e){return s.push(e),e}))),o.on("message",(function(e){s.push(e),n.update(s)})),t.sort((function(e,t){return e.z-t.z}));for(var i=0;i<t.length;i++){var r=new ne(pe),d=t[i],c=d._id,u=d.x,h=d.y,l=d.z,f=d.frontside,p=d.player;r._id=c,r.x=u,r.y=h,r.z=l,r.i=t[i].i,r.frontside=f,r.player=p,r.update(),t[i].deck&&me.push(r),pe.push(r)}})),o.on("player",(function(e){a[e._id]=e,pe.players.find((function(t){return t._id===e._id}))||pe.pushPlayer(e)})),o.on("playercard",(function(e){pe.players.forEach((function(e){var t=0;pe.cards.forEach((function(n){if(n.player===e._id){var i=16*(e.x+1*t),o=16*e.y;n.x=i,n.y=o,n.z=Date.now(),n.update(),t++}}))}))})),o.on("cardmovestart",(function(e){var t=e._id,n=pe.cards.find((function(e){return e._id===t}));n&&(n.player||(pe.remove(n),pe.push(n)))})),o.on("cardmove",(function(e){var t=e._id,n=e.x,i=e.y,o=pe.cards.find((function(e){return e._id===t}));o&&o.move(n,i)})),o.on("cardflip",(function(e){var t=e._id,n=e.i,i=e.frontside,o=pe.cards.find((function(e){return e._id===t}));o&&(o.i=n,o.frontside=i,o.update())})),o.on("deckpop",(function(e){var t=e._id;pe.cards.find((function(e){return e._id===t}))&&me.pop()})),o.on("reset",(function(e){pe.cards.length=e.length,me.cards.length=e.length;for(var t=0;t<e.length;t++){var n=pe.cards[t]||new ne(pe),i=e[t],o=i._id,s=i.x,r=i.y,a=i.z,d=i.frontside,c=i.player;n._id=o,n.x=s,n.y=r,n.z=a,n.i=e[t].i,n.frontside=d,n.player=c,n.update(),me.cards[t]=n,pe.cards[t]=n}pe.deck.collect()})),o.on("shuffle",(function(){pe.deck.collect().then((function(){return pe.deck.shuffle()}))})),pe.socket=o};window.startMultiplayer=ge;var we=new S;window.castSpectate||r(document.body,we);var _e,xe,ke,be=new b(ce,{oncancel:function(){be.update(null)}});r(document.body,be),window.multiplayer&&be.update(!0,{join:!0,game:window.game,onstart:function(e){var t=e.game,n=e.player;ge(t,n),be.update(!1)}}),we.update([window.multiplayer?{name:"Single player",onclick:function(){window.location.pathname="/"}}:{name:"Multiplayer",onclick:function(){be.update(!0,{multiplayer:be})}},{name:"Shuffle",onclick:function(){window.multiplayer?pe.socket.emit("shuffle"):pe.deck.collect().then((function(){return pe.deck.shuffle()})).then((function(){fe.deck.shuffle(),pe.deck.cards.forEach((function(e,t){e.i=fe.deck.cards[t].i,e.update()}))}))}},{name:"Add deck",onclick:function(){if(window.multiplayer)pe.socket.emit("add-deck");else{for(var e=0;e<54;e++){var t=new se(fe);t.i=e,fe.deck.cards.push(t);var n=new ne(pe);n._id=fe.deck.cards[e]._id,n.i=fe.deck.cards[e].i,n.x=-me.d*(e+fe.deck.cards.length),n.y=-300-me.d*(e+fe.deck.cards.length),n.update(),me.push(n),pe.push(n)}pe.deck.collect()}}}]);var Ee=function(e){if((0!==e.touches.length||e.stage)&&!e.card){var t;e.preventDefault(),1===e.touches.length?(xe={x:pe.x,y:pe.y},ke={x:e.touches[0].pageX,y:e.touches[0].pageY}):2===e.touches.length&&(xe={x:pe.x,y:pe.y},_e=pe.size,ke={x:e.touches[0].pageX+(e.touches[1].pageX-e.touches[0].pageX)/2,y:e.touches[0].pageY+(e.touches[1].pageY-e.touches[0].pageY)/2});var n=function(e){if(e.preventDefault(),1===e.touches.length){var n={x:e.touches[0].pageX,y:e.touches[0].pageY},i={x:n.x-ke.x,y:n.y-ke.y};pe.x=xe.x+i.x,pe.y=xe.y+i.y,pe.update()}else if(2===e.touches.length){var o=e.touches[0].pageX,s=e.touches[0].pageY,r=e.touches[1].pageX,a=e.touches[1].pageY,d=Math.sqrt(Math.pow(r-o,2)+Math.pow(a-s,2));null==t&&(t=d),pe.size=_e*d/t,pe.update();var c={x:e.touches[0].pageX+(e.touches[1].pageX-e.touches[0].pageX)/2,y:e.touches[0].pageY+(e.touches[1].pageY-e.touches[0].pageY)/2},u={x:c.x-ke.x,y:c.y-ke.y};pe.x=xe.x+u.x,pe.y=xe.y+u.y,pe.update()}},i=function(e){window.removeEventListener("touchstart",Ee,te),window.removeEventListener("touchmove",n,te),window.removeEventListener("touchend",i,te)};window.addEventListener("touchmove",n,te),window.addEventListener("touchend",i,te)}};pe.el.addEventListener("touchstart",(function(e){e.stage=!0,Ee(e),window.addEventListener("touchstart",Ee,te)}),te);pe.el.addEventListener("mousedown",(function(e){e.stage=!0})),window.addEventListener("mousedown",(function(e){if(e.stage&&!(e.card||e.which>1)){e.preventDefault();var t=pe.x,n=pe.y,i=e.pageX,o=e.pageY,s=function(e){var s=e.pageX-i,r=e.pageY-o;pe.x=t+s,pe.y=n+r,pe.update()},r=function(e){window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r)};window.addEventListener("mousemove",s),window.addEventListener("mouseup",r)}}));var Le=function(){var e=window.innerWidth,t=window.innerHeight,n=Math.max(.25,Math.min(e/1600,t/900));pe.size=n,pe.update()};Le(),window.addEventListener("resize",(function(){pe.update()})),window.addEventListener("orientationchange",(function(){requestAnimationFrame((function(){Le()}))}));window.addEventListener("wheel",(function(e){for(var t=e.target;t;){if("messages"===t.className)return;t=t.parentNode}e.preventDefault(),pe.size+=-.0025*e.deltaY,pe.update()}),te),"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/sw.js",{scope:"/"}).then((function(e){console.log("Registration succeeded. Scope is "+e.scope)})).catch((function(e){console.error("Registration failed with "+e)}))}))}();
